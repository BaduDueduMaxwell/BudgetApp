<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Budget App | Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/dashboard_style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Jomhuria"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <header>
      <div class="topnav">
        <a href="/dashboard/{{user_id}}" class="active logo">Dashboard</a>
        <div id="myLinks">
          <a href="/expenses/{{user_id}}">Expenses</a>
          <a href="/income/{{user_id}}">Income</a>
          <a href="/summary/{{user_id}}">Summary</a>
          <a href="/setting">Settings</a>
          <a href="#">Logout</a>
        </div>
        <a href="javascript:void(0);" class="icon" onclick="navBar()">
          <i class="fa fa-bars"></i>
        </a>
      </div>
    </header>
    <section>
      <div class="intro">
        <h4>Hi, {{ first_name }}</h4>
        <p>
          Embrace the power of saving – it's not just a moment, it's a mindset.
        </p>
      </div>
      <h3 class="result__title">Expenses Results</h3>
      <div class="card">
        <div class="card__info">
          <h6>Total Income</h6>
          <p>${{ total_income if total_income else '0' }}</p>
        </div>
        <div class="card__info">
          <h6>Total Expenses</h6>
          <p>${{ total_expenses if total_expenses else '0' }}</p>
        </div>
        <div class="card__info">
          <div>
            <h6>Savings</h6>
            <span
              >{{ percentage_savings if percentage_savings else '--%' }}</span
            >
          </div>
          <p>${{ savings if savings else '0' }}</p>
        </div>
      </div>
      <div class="chart-container">
        <div class="chart__diagram">
          <h3 class="result__title">Total Overview</h3>
          <canvas id="pieChart"></canvas>
        </div>
        <div class="chart__diagram">
          <h3 class="result__title">Line Graph</h3>
          <canvas id="lineChart"></canvas>
        </div>
        <div class="chart__diagram">
          <h4>Expenditures</h4>
          <canvas id="myChart"></canvas>
        </div>
      </div>
    </section>
    <footer>
      <div>
        <span
          >© 2023 <a href="https://BudgetApp.com/">BudgetApp</a>. All Rights
          Reserved.
        </span>
        <ul>
          <li>
            <a href="#">About</a>
          </li>
          <li>
            <a href="#">Privacy Policy</a>
          </li>
          <li>
            <a href="#">Licensing</a>
          </li>
          <li>
            <a href="#">Contact</a>
          </li>
        </ul>
      </div>
    </footer>
    <script>
      function updatePieChart(data) {
          var pieCtx = document.getElementById('pieChart').getContext('2d');
          var pieChart = new Chart(pieCtx, {
              type: 'pie',
              data: {
                  labels: ['Total Income', 'Total Expenses', 'Savings'],
                  datasets: [{
                      data: [data.totalIncome, data.totalExpenses, data.savings],
                      backgroundColor: ['#001F3F', '#006400', '#708090'],
                      borderColor: 'white',
                      borderWidth: 2
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  title: {
                      display: true,
                      text: 'Financial Overview',
                      fontSize: 18,
                      fontColor: 'black'
                  },
                  legend: {
                      position: 'right',
                      labels: {
                          boxWidth: 15,
                          fontStyle: 'bold'
                      }
                  }
              }
          });
      }

      // Use the financial_data passed from the server
      var financialData = {{ financial_data | tojson | safe | e }};

      // Update the pie chart with the fetched data
      updatePieChart(financialData);
    </script>
    <script>
      // function for navbar
      const navBar = () => {
        let x = document.getElementById("myLinks");

        if (x.style.display === "block") {
          x.style.display = "none";
        } else {
          x.style.display = "block";
        }
      }

      // function for charts
      function updateChart(data) {
          var ctx = document.getElementById('myChart').getContext('2d');
          var myChart = new Chart(ctx, {
              type: 'doughnut',
              data: {
                  labels: data.labels,
                  datasets: [{
                      label: 'Expenses',
                      data: data.expensesData,
                      backgroundColor: data.backgroundColor,
                      borderColor: 'white',
                      borderWidth: 2
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  cutoutPercentage: 70,
                  title: {
                      display: true,
                      text: 'Expenses by Category',
                      fontSize: 18,
                      fontColor: 'black'
                  },
                  legend: {
                      position: 'right',
                      labels: {
                          boxWidth: 15,
                          fontStyle: 'bold'
                      }
                  }
              }
          });



          var lineCtx = document.getElementById('lineChart').getContext('2d');
          var lineChart = new Chart(lineCtx, {
              type: 'line',
              data: {
                  labels: data.dailyLabels,
                  datasets: [{
                      label: 'Daily Expenses',
                      data: data.dailyExpenses,
                      fill: false,
                      borderColor: '#e74c3c',
                      borderWidth: 2,
                      pointRadius: 5,
                      pointBackgroundColor: '#e74c3c',
                      pointBorderColor: 'white',
                      pointBorderWidth: 2,
                      pointHoverRadius: 7,
                      pointHoverBackgroundColor: 'white',
                      pointHoverBorderColor: '#e74c3c'
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  title: {
                      display: true,
                      text: 'Daily Expenses',
                      fontSize: 18,
                      fontColor: 'black'
                  },
                  legend: {
                      display: false
                  },
                  scales: {
                      xAxes: [{
                          display: true,
                          scaleLabel: {
                              display: true,
                              labelString: 'Day'
                          }
                      }],
                      yAxes: [{
                          display: true,
                          scaleLabel: {
                              display: true,
                              labelString: 'Expense ($)'
                          }
                      }]
                  }
              }
          });
      }

      // Use the expenses_data passed from the server
      var expensesData = {{ expenses_data | tojson | safe | e }};

      // Update the chart with the fetched data
      updateChart(expensesData);
    </script>
  </body>
</html>
